<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Masseria Potenti - Wedding Venue Review</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --olive: #5c6b4d;
            --olive-light: #8fa578;
            --terracotta: #c4724e;
            --cream: #f8f5f0;
            --stone: #d4cdc4;
            --charcoal: #2d2d2d;
            --gold: #b8956e;
            --white: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--cream);
            color: var(--charcoal);
            line-height: 1.6;
        }

        h1, h2, h3, h4 {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 500;
        }

        /* Hero Section */
        .hero {
            position: relative;
            height: 100vh;
            min-height: 600px;
            background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.4)),
                        url('https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=1600');
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: var(--white);
        }

        .hero-content {
            max-width: 800px;
            padding: 2rem;
        }

        .hero h1 {
            font-size: clamp(3rem, 8vw, 5rem);
            margin-bottom: 0.5rem;
            letter-spacing: 0.1em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .hero .location {
            font-size: 1.2rem;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            margin-bottom: 1.5rem;
            opacity: 0.9;
        }

        .hero .tagline {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            font-style: italic;
            opacity: 0.95;
        }

        .status-badge {
            display: inline-block;
            background: var(--olive);
            padding: 0.5rem 1.5rem;
            border-radius: 2px;
            font-size: 0.8rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-top: 2rem;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 1rem 2rem;
            display: flex;
            justify-content: center;
            gap: 2rem;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        nav.visible {
            transform: translateY(0);
        }

        nav a {
            color: var(--charcoal);
            text-decoration: none;
            font-size: 0.85rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            padding: 0.5rem 1rem;
            transition: color 0.3s;
        }

        nav a:hover {
            color: var(--olive);
        }

        /* Sections */
        section {
            padding: 5rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .section-header h2 {
            font-size: clamp(2rem, 5vw, 3rem);
            color: var(--charcoal);
            margin-bottom: 0.5rem;
        }

        .section-header .subtitle {
            color: var(--olive);
            font-size: 0.9rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }

        /* Quick Facts */
        .quick-facts {
            background: var(--white);
            padding: 4rem 2rem;
        }

        .facts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .fact-card {
            text-align: center;
            padding: 2rem;
        }

        .fact-card .icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .fact-card h4 {
            font-size: 1.5rem;
            color: var(--charcoal);
            margin-bottom: 0.5rem;
        }

        .fact-card p {
            color: #666;
            font-size: 0.9rem;
        }

        /* Photo Gallery */
        .gallery {
            background: var(--stone);
            padding: 5rem 0;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(3, 200px);
            gap: 1rem;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: 4px;
            cursor: pointer;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        .gallery-item .overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1.5rem;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            color: white;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .gallery-item:hover .overlay {
            opacity: 1;
        }

        .gallery-item:nth-child(1) { grid-column: span 8; grid-row: span 2; }
        .gallery-item:nth-child(2) { grid-column: span 4; }
        .gallery-item:nth-child(3) { grid-column: span 4; }
        .gallery-item:nth-child(4) { grid-column: span 4; }
        .gallery-item:nth-child(5) { grid-column: span 4; }
        .gallery-item:nth-child(6) { grid-column: span 4; }

        /* Spaces Section */
        .spaces-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .space-card {
            background: var(--white);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .space-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .space-card-content {
            padding: 1.5rem;
        }

        .space-card h4 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: var(--charcoal);
        }

        .space-card p {
            color: #666;
            font-size: 0.9rem;
        }

        .space-tag {
            display: inline-block;
            background: var(--olive-light);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 2px;
            font-size: 0.7rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-top: 1rem;
        }

        /* Map Section */
        .map-section {
            background: var(--white);
        }

        .maps-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }

        @media (max-width: 1000px) {
            .maps-wrapper {
                grid-template-columns: 1fr;
            }
        }

        .map-card {
            background: var(--cream);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .map-card-header {
            padding: 1.5rem;
            background: var(--white);
            border-bottom: 1px solid var(--stone);
        }

        .map-card-header h3 {
            font-size: 1.3rem;
            color: var(--charcoal);
            margin-bottom: 0.25rem;
        }

        .map-card-header p {
            font-size: 0.9rem;
            color: #666;
        }

        .map-frame {
            width: 100%;
            height: 400px;
            border: none;
        }

        .map-frame iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Flight Path D3 Map */
        .flight-map {
            width: 100%;
            height: 400px;
            background: linear-gradient(135deg, #0f1419 0%, #1a2332 40%, #1e3a5f 100%);
            position: relative;
            overflow: hidden;
        }

        .flight-map svg {
            width: 100%;
            height: 100%;
        }

        .land {
            fill: #2a3f4f;
            stroke: #3d5a6e;
            stroke-width: 0.5;
        }

        .land:hover {
            fill: #345566;
        }

        .graticule {
            fill: none;
            stroke: rgba(255,255,255,0.05);
            stroke-width: 0.5;
        }

        .flight-route {
            fill: none;
            stroke: url(#routeGradient);
            stroke-width: 2.5;
            stroke-linecap: round;
            filter: drop-shadow(0 0 8px rgba(184, 149, 110, 0.5));
        }

        .flight-route-glow {
            fill: none;
            stroke: rgba(184, 149, 110, 0.3);
            stroke-width: 8;
            stroke-linecap: round;
            filter: blur(4px);
        }

        .route-dash {
            fill: none;
            stroke: rgba(255,255,255,0.6);
            stroke-width: 1;
            stroke-dasharray: 4, 8;
        }

        .city-marker {
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));
        }

        .city-marker-ring {
            fill: none;
            stroke: rgba(184, 149, 110, 0.6);
            stroke-width: 1.5;
        }

        .city-marker-pulse {
            fill: none;
            stroke: rgba(184, 149, 110, 0.4);
            stroke-width: 1;
            animation: pulse 2s ease-out infinite;
        }

        @keyframes pulse {
            0% { r: 8; opacity: 1; }
            100% { r: 20; opacity: 0; }
        }

        .city-label {
            font-family: 'Montserrat', sans-serif;
            font-size: 11px;
            font-weight: 600;
            fill: #fff;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
        }

        .city-sublabel {
            font-family: 'Montserrat', sans-serif;
            font-size: 9px;
            font-weight: 400;
            fill: rgba(255,255,255,0.7);
        }

        .plane-icon {
            fill: #b8956e;
            filter: drop-shadow(0 2px 6px rgba(0,0,0,0.5));
            transition: transform 0.1s ease-out;
        }

        .venue-marker {
            fill: #c4724e;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));
        }

        .venue-star {
            fill: #f6e05e;
            filter: drop-shadow(0 0 6px rgba(246, 224, 94, 0.6));
        }

        .flight-map svg {
            cursor: grab;
        }

        .flight-map svg:active {
            cursor: grabbing;
        }

        .zoom-hint {
            position: absolute;
            bottom: 8px;
            left: 10px;
            font-size: 10px;
            color: rgba(255,255,255,0.4);
            pointer-events: none;
        }

        .leg-info {
            display: flex;
            justify-content: space-around;
            padding: 1rem;
            background: var(--white);
        }

        .leg {
            text-align: center;
            padding: 0.5rem 1rem;
        }

        .leg-route {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--charcoal);
        }

        .leg-duration {
            font-size: 0.75rem;
            color: var(--olive);
            margin-top: 0.25rem;
        }

        .leg-divider {
            width: 1px;
            background: var(--stone);
        }

        .route-info {
            padding: 1.5rem;
            background: var(--white);
        }

        .route-info h4 {
            font-size: 1rem;
            color: var(--olive);
            margin-bottom: 0.75rem;
        }

        .route-info p {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.6;
        }

        .route-total {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--stone);
        }

        .route-total .time {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            color: var(--charcoal);
        }

        .route-total .label {
            font-size: 0.8rem;
            color: #666;
        }

        /* Budget Calculator */
        .budget-section {
            background: linear-gradient(135deg, var(--olive) 0%, #4a5a3e 100%);
            color: var(--white);
            padding: 5rem 2rem;
        }

        .budget-section .section-header h2 {
            color: var(--white);
        }

        .budget-section .subtitle {
            color: var(--olive-light);
        }

        .budget-calculator {
            background: var(--white);
            border-radius: 12px;
            padding: 3rem;
            color: var(--charcoal);
            max-width: 1200px;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .calculator-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--stone);
        }

        .control-group label {
            display: block;
            font-size: 0.8rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--olive);
            margin-bottom: 0.75rem;
            font-weight: 500;
        }

        .control-group select,
        .control-group input[type="range"] {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--stone);
            border-radius: 4px;
            font-family: inherit;
            font-size: 1rem;
            background: var(--white);
            cursor: pointer;
        }

        .control-group select:focus {
            outline: none;
            border-color: var(--olive);
        }

        .slider-container {
            position: relative;
        }

        .slider-value {
            text-align: center;
            font-size: 2rem;
            font-family: 'Cormorant Garamond', serif;
            color: var(--charcoal);
            margin-bottom: 0.5rem;
        }

        input[type="range"] {
            -webkit-appearance: none;
            height: 8px;
            background: var(--stone);
            border-radius: 4px;
            border: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--olive);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--cream);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .checkbox-item:hover {
            background: var(--stone);
        }

        .checkbox-item.active {
            background: var(--olive-light);
            color: white;
            border-color: var(--olive);
        }

        .checkbox-item input {
            display: none;
        }

        /* Budget Results */
        .budget-results {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 3rem;
        }

        @media (max-width: 800px) {
            .budget-results {
                grid-template-columns: 1fr;
            }
        }

        .breakdown-table {
            width: 100%;
            border-collapse: collapse;
        }

        .breakdown-table th {
            text-align: left;
            padding: 1rem;
            background: var(--cream);
            font-size: 0.8rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--olive);
        }

        .breakdown-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--stone);
        }

        .breakdown-table .item-name {
            font-weight: 500;
        }

        .breakdown-table .item-detail {
            font-size: 0.85rem;
            color: #666;
        }

        .breakdown-table .item-price {
            text-align: right;
            font-weight: 500;
            white-space: nowrap;
        }

        .breakdown-table tr.total-row td {
            border-top: 2px solid var(--charcoal);
            border-bottom: none;
            font-weight: 600;
            font-size: 1.1rem;
            padding-top: 1.5rem;
        }

        .total-display {
            background: var(--cream);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
        }

        .total-display .label {
            font-size: 0.8rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--olive);
            margin-bottom: 0.5rem;
        }

        .total-display .amount {
            font-family: 'Cormorant Garamond', serif;
            font-size: 3.5rem;
            color: var(--charcoal);
            line-height: 1;
        }

        .total-display .amount.over-budget {
            color: var(--terracotta);
        }

        .total-display .amount.under-budget {
            color: var(--olive);
        }

        .total-display .budget-status {
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .total-display .budget-status.good {
            background: rgba(92, 107, 77, 0.15);
            color: var(--olive);
        }

        .total-display .budget-status.warning {
            background: rgba(184, 149, 110, 0.2);
            color: var(--gold);
        }

        .total-display .budget-status.over {
            background: rgba(196, 114, 78, 0.15);
            color: var(--terracotta);
        }

        .remaining {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--stone);
        }

        .remaining .label {
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
        }

        .remaining .amount {
            font-size: 1.5rem;
        }

        /* Budget Matrix */
        .matrix-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--stone);
        }

        .matrix-section h3 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .budget-matrix {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .budget-matrix th {
            background: var(--olive);
            color: white;
            padding: 1rem;
            text-align: center;
            font-weight: 500;
        }

        .budget-matrix th:first-child {
            text-align: left;
        }

        .budget-matrix td {
            padding: 0.75rem 1rem;
            text-align: center;
            border-bottom: 1px solid var(--stone);
        }

        .budget-matrix td:first-child {
            text-align: left;
            font-weight: 500;
            background: var(--cream);
        }

        .budget-matrix .good { color: var(--olive); font-weight: 600; }
        .budget-matrix .warning { color: var(--gold); font-weight: 600; }
        .budget-matrix .over { color: var(--terracotta); font-weight: 600; }

        /* Culinary Section */
        .culinary-section {
            background: var(--white);
        }

        .menu-tiers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .menu-card {
            background: var(--cream);
            border-radius: 12px;
            padding: 2rem;
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .menu-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.1);
        }

        .menu-card.recommended {
            background: var(--olive);
            color: white;
        }

        .menu-card.recommended .menu-price {
            color: var(--olive-light);
        }

        .menu-card .badge {
            position: absolute;
            top: -10px;
            right: 20px;
            background: var(--gold);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 2px;
            font-size: 0.7rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .menu-card h4 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .menu-price {
            font-size: 2rem;
            font-family: 'Cormorant Garamond', serif;
            color: var(--olive);
            margin-bottom: 1.5rem;
        }

        .menu-price span {
            font-size: 1rem;
            opacity: 0.7;
        }

        .menu-features {
            list-style: none;
        }

        .menu-features li {
            padding: 0.5rem 0;
            font-size: 0.9rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .menu-features li::before {
            content: "✓";
            color: var(--olive-light);
            font-weight: bold;
        }

        .menu-card.recommended .menu-features li::before {
            color: white;
        }

        /* Pros/Cons */
        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }

        @media (max-width: 700px) {
            .pros-cons {
                grid-template-columns: 1fr;
            }
        }

        .pros h3 { color: var(--olive); }
        .cons h3 { color: var(--terracotta); }

        .pros-cons ul {
            list-style: none;
            margin-top: 1.5rem;
        }

        .pros-cons li {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--stone);
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .pros li::before {
            content: "✓";
            color: var(--olive);
            font-weight: bold;
        }

        .cons li::before {
            content: "!";
            color: var(--terracotta);
            font-weight: bold;
            background: rgba(196, 114, 78, 0.15);
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 0.8rem;
        }

        /* CTA Section */
        .cta-section {
            background: var(--charcoal);
            color: white;
            text-align: center;
            padding: 5rem 2rem;
        }

        .cta-section h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .cta-section p {
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto 2rem;
        }

        .cta-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-block;
            padding: 1rem 2rem;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--olive);
            color: white;
        }

        .btn-primary:hover {
            background: var(--olive-light);
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-secondary:hover {
            background: white;
            color: var(--charcoal);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .gallery-grid {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto;
            }

            .gallery-item:nth-child(1) { grid-column: span 2; grid-row: span 1; }
            .gallery-item:nth-child(n) { grid-column: span 1; }

            .budget-calculator {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <nav id="nav">
        <a href="#overview">Overview</a>
        <a href="#spaces">Spaces</a>
        <a href="#location">Location</a>
        <a href="#budget">Budget</a>
        <a href="#menu">Menu</a>
    </nav>

    <section class="hero">
        <div class="hero-content">
            <h1>Masseria Potenti</h1>
            <p class="location">Manduria, Salento, Puglia</p>
            <p class="tagline">A timeless 16th-century farmhouse in the heart of Puglia where love and tradition intertwine</p>
            <span class="status-badge">Available for Inquiry</span>
        </div>
    </section>

    <section class="quick-facts" id="overview">
        <div class="facts-grid">
            <div class="fact-card">
                <div class="icon">&#127965;</div>
                <h4>30-100 Guests</h4>
                <p>Up to 250 with restaurant capacity</p>
            </div>
            <div class="fact-card">
                <div class="icon">&#127968;</div>
                <h4>Up to 100 Beds</h4>
                <p>21 rooms + 3 private villas (4 bed each)</p>
            </div>
            <div class="fact-card">
                <div class="icon">&#127860;</div>
                <h4>Organic Farm</h4>
                <p>Own olive oil, wine & flour production</p>
            </div>
            <div class="fact-card">
                <div class="icon">&#128337;</div>
                <h4>3-Night Minimum</h4>
                <p>Exclusive use buyout available</p>
            </div>
            <div class="fact-card">
                <div class="icon">&#9992;</div>
                <h4>45 min from BDS</h4>
                <p>Brindisi Airport / 1.5hr from Bari</p>
            </div>
            <div class="fact-card">
                <div class="icon">&#127796;</div>
                <h4>Historic Estate</h4>
                <p>16th-century fortified farmhouse</p>
            </div>
        </div>
    </section>

    <section class="gallery" id="spaces">
        <div class="section-header">
            <p class="subtitle">The Venue</p>
            <h2>Stunning Salento Spaces</h2>
        </div>
        <div class="gallery-grid">
            <div class="gallery-item">
                <img src="https://images.unsplash.com/photo-1519167758481-83f550bb49b3?w=1200" alt="Masseria courtyard">
                <div class="overlay">
                    <strong>Main Courtyard</strong>
                    <p>Historic stone courtyard</p>
                </div>
            </div>
            <div class="gallery-item">
                <img src="https://images.unsplash.com/photo-1523438885200-e635ba2c371e?w=600" alt="Olive grove">
                <div class="overlay">
                    <strong>Olive Grove</strong>
                </div>
            </div>
            <div class="gallery-item">
                <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=600" alt="Pool area">
                <div class="overlay">
                    <strong>Pool & Gardens</strong>
                </div>
            </div>
            <div class="gallery-item">
                <img src="https://images.unsplash.com/photo-1478146896981-b80fe463b330?w=600" alt="Dining setup">
                <div class="overlay">
                    <strong>Elegant Dining</strong>
                </div>
            </div>
            <div class="gallery-item">
                <img src="https://images.unsplash.com/photo-1519225421980-715cb0215aed?w=600" alt="Glasshouse">
                <div class="overlay">
                    <strong>Glasshouse</strong>
                </div>
            </div>
            <div class="gallery-item">
                <img src="https://images.unsplash.com/photo-1584132967334-10e028bd69f7?w=600" alt="Roof terrace">
                <div class="overlay">
                    <strong>Roof Terrace</strong>
                </div>
            </div>
        </div>
    </section>

    <section>
        <div class="section-header">
            <p class="subtitle">Ceremony & Reception</p>
            <h2>Available Spaces</h2>
        </div>
        <div class="spaces-grid">
            <div class="space-card">
                <img src="https://images.unsplash.com/photo-1519167758481-83f550bb49b3?w=600" alt="Courtyard">
                <div class="space-card-content">
                    <h4>Main Courtyard</h4>
                    <p>Historic stone courtyard perfect for ceremonies, aperitivo, and candlelit dinners under the stars.</p>
                    <span class="space-tag">Ceremony / Reception</span>
                </div>
            </div>
            <div class="space-card">
                <img src="https://images.unsplash.com/photo-1523438885200-e635ba2c371e?w=600" alt="Olive grove">
                <div class="space-card-content">
                    <h4>Ancient Olive Grove</h4>
                    <p>Romantic ceremonies surrounded by centuries-old olive trees and Mediterranean light.</p>
                    <span class="space-tag">Ceremony / Dinners</span>
                </div>
            </div>
            <div class="space-card">
                <img src="https://images.unsplash.com/photo-1534430480872-3498386e7856?w=600" alt="Roof terrace">
                <div class="space-card-content">
                    <h4>Roof Terrace</h4>
                    <p>Sunset cocktails and intimate dinners with panoramic views over the Salento countryside.</p>
                    <span class="space-tag">Cocktails / Dinners</span>
                </div>
            </div>
            <div class="space-card">
                <img src="https://images.unsplash.com/photo-1519225421980-715cb0215aed?w=600" alt="Glasshouse">
                <div class="space-card-content">
                    <h4>The Glasshouse</h4>
                    <p>Romantic indoor dining and ceremony space with natural light and elegant architecture.</p>
                    <span class="space-tag">All-weather</span>
                </div>
            </div>
            <div class="space-card">
                <img src="https://images.unsplash.com/photo-1584132967334-10e028bd69f7?w=600" alt="Pool area">
                <div class="space-card-content">
                    <h4>Pool & Gardens</h4>
                    <p>Relaxed brunch venue and pizza party space with pool and lush Mediterranean gardens.</p>
                    <span class="space-tag">Brunch / Pre-wedding</span>
                </div>
            </div>
            <div class="space-card">
                <img src="https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=600" alt="Cave">
                <div class="space-card-content">
                    <h4>The Cave</h4>
                    <p>Unique underground space for welcome lunches and dinners in a naturally cool environment.</p>
                    <span class="space-tag">Welcome Meals</span>
                </div>
            </div>
            <div class="space-card">
                <img src="https://images.unsplash.com/photo-1555244162-803834f70033?w=600" alt="Trullo">
                <div class="space-card-content">
                    <h4>Traditional Trullo</h4>
                    <p>Intimate romantic dinners in an authentic Puglian trullo structure.</p>
                    <span class="space-tag">Intimate Dinners</span>
                </div>
            </div>
            <div class="space-card">
                <img src="https://images.unsplash.com/photo-1511795409834-ef04bbd61622?w=600" alt="Marquee">
                <div class="space-card-content">
                    <h4>Lights Marquee</h4>
                    <p>Large-scale events space for 250+ guests with stage capacity for concerts and performances.</p>
                    <span class="space-tag">Large Events</span>
                </div>
            </div>
            <div class="space-card">
                <img src="https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=600" alt="Beach bistro">
                <div class="space-card-content">
                    <h4>Beach Bistro</h4>
                    <p>Beachside dining near the flamingo reserve in Torre Colimena, a short drive from the masseria.</p>
                    <span class="space-tag">Day Trip</span>
                </div>
            </div>
        </div>
    </section>

    <section class="map-section" id="location">
        <div class="section-header">
            <p class="subtitle">Getting There</p>
            <h2>Location & Travel</h2>
        </div>
        <div class="maps-wrapper">
            <!-- Flight Path Map -->
            <div class="map-card">
                <div class="map-card-header">
                    <h3>Your Journey from LA</h3>
                    <p>LAX to Masseria Potenti via Rome & Brindisi</p>
                </div>
                <div class="flight-map" id="flightMap"></div>
                <div class="leg-info">
                    <div class="leg">
                        <div class="leg-route">LAX → FCO</div>
                        <div class="leg-duration">~12 hours</div>
                    </div>
                    <div class="leg-divider"></div>
                    <div class="leg">
                        <div class="leg-route">FCO → BDS</div>
                        <div class="leg-duration">~1 hour</div>
                    </div>
                    <div class="leg-divider"></div>
                    <div class="leg">
                        <div class="leg-route">BDS → Venue</div>
                        <div class="leg-duration">~45 min</div>
                    </div>
                </div>
                <div class="route-info">
                    <h4>Recommended Route</h4>
                    <p>Fly LAX to Rome Fiumicino (FCO), then connect to Brindisi (BDS). Direct flights from Rome to Brindisi run frequently. From Brindisi Airport, it's a scenic 45-minute drive through the Salento countryside to Manduria.</p>
                    <div class="route-total">
                        <div class="time">~15h</div>
                        <div class="label">Total door-to-door<br>travel time</div>
                    </div>
                </div>
            </div>

            <!-- Driving Directions Map -->
            <div class="map-card">
                <div class="map-card-header">
                    <h3>Airport to Venue</h3>
                    <p>Brindisi Airport (BDS) → Masseria Potenti</p>
                </div>
                <div class="map-frame">
                    <iframe
                        src="https://www.google.com/maps/embed?pb=!1m28!1m12!1m3!1d97349.036341393!2d17.4!3d40.4!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!4m13!3e0!4m5!1s0x1347d99d87d25deb%3A0x3e80e5b7e7c8e9e8!2sBrindisi%20Airport%2C%20Brindisi%2C%20Italy!3m2!1d40.6576!2d17.947!4m5!1s0x13471e8d8e8e8e8e%3A0x1234567890abcdef!2sContrada%20Potenti%2C%2074024%20Manduria%2C%20Italy!3m2!1d40.4!2d17.6!5e0!3m2!1sen!2sus!4v1706000000000!5m2!1sen!2sus"
                        allowfullscreen=""
                        loading="lazy"
                        referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>
                <div class="route-info">
                    <h4>The Drive</h4>
                    <p>Head northwest through the heart of Salento, passing vineyards and olive groves. The route takes you through charming towns like San Pancrazio Salentino before arriving in Manduria, famous for its Primitivo wine.</p>
                    <div class="route-total">
                        <div class="time">45 min</div>
                        <div class="label">From Brindisi Airport<br>40 km / 25 miles</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="budget-section" id="budget">
        <div class="section-header">
            <p class="subtitle">Plan Your Budget</p>
            <h2>Interactive Cost Calculator</h2>
        </div>

        <div class="budget-calculator">
            <div class="calculator-controls">
                <div class="control-group">
                    <label>Number of Guests</label>
                    <div class="slider-container">
                        <div class="slider-value" id="guestDisplay">40</div>
                        <input type="range" id="guestSlider" min="30" max="100" value="40">
                    </div>
                </div>

                <div class="control-group">
                    <label>Number of Nights</label>
                    <select id="nightsSelect">
                        <option value="3" selected>3 Nights (minimum)</option>
                        <option value="4">4 Nights</option>
                        <option value="5">5 Nights</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Menu Package</label>
                    <select id="menuSelect">
                        <option value="180" selected>Base Menu - €180/person</option>
                        <option value="195">Base + Raw Sea - €195/person</option>
                        <option value="210">Premium Menu - €210/person</option>
                        <option value="230">Exclusive Menu - €230/person</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Open Bar Hours</label>
                    <select id="barSelect">
                        <option value="3" selected>3 Hours - €4,000</option>
                        <option value="4">4 Hours - €4,800</option>
                        <option value="5">5 Hours - €5,600</option>
                        <option value="6">6 Hours - €6,400</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Private Villas</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item" data-addon="villa1" data-price="1600">
                            <input type="checkbox" id="villa1"> Villa 1 (€1,600/night)
                        </label>
                        <label class="checkbox-item" data-addon="villa2" data-price="1600">
                            <input type="checkbox" id="villa2"> Villa 2 (€1,600/night)
                        </label>
                        <label class="checkbox-item" data-addon="villa3" data-price="1600">
                            <input type="checkbox" id="villa3"> Villa 3 (€1,600/night)
                        </label>
                    </div>
                </div>

                <div class="control-group">
                    <label>Food Add-ons</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item" data-addon="corner" data-price="15">
                            <input type="checkbox" id="corner"> Food Corner (+€15/pp)
                        </label>
                        <label class="checkbox-item" data-addon="seafoodcorner" data-price="20">
                            <input type="checkbox" id="seafoodcorner"> Seafood Corner (+€20/pp)
                        </label>
                    </div>
                </div>

                <div class="control-group">
                    <label>Additional Meals</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item" data-addon="welcome" data-price="60">
                            <input type="checkbox" id="welcome"> Welcome Dinner (+€60/pp)
                        </label>
                        <label class="checkbox-item" data-addon="farewell" data-price="50">
                            <input type="checkbox" id="farewell"> Farewell Brunch (+€50/pp)
                        </label>
                    </div>
                </div>
            </div>

            <div class="budget-results">
                <div class="breakdown">
                    <table class="breakdown-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Cost</th>
                            </tr>
                        </thead>
                        <tbody id="breakdownBody">
                            <!-- Filled by JS -->
                        </tbody>
                    </table>
                </div>

                <div class="total-display">
                    <div class="label">Estimated Total</div>
                    <div class="amount" id="totalAmount">$45,000</div>
                    <div class="budget-status good" id="budgetStatus">Over budget by $15,000</div>

                    <div class="remaining">
                        <div class="label">Remaining for Photo/Video/Music</div>
                        <div class="amount" id="remainingAmount">-$15,000</div>
                    </div>
                </div>
            </div>

            <div class="matrix-section">
                <h3>Full Budget Matrix</h3>
                <p style="text-align: center; color: #666; margin-bottom: 1.5rem; font-size: 0.9rem;">
                    3-night exclusive use costs by guest count (includes venue buyout, base menu, 3hr open bar)
                </p>
                <table class="budget-matrix">
                    <thead>
                        <tr>
                            <th>Configuration</th>
                            <th>30 Guests</th>
                            <th>40 Guests</th>
                            <th>50 Guests</th>
                            <th>66 Guests</th>
                            <th>80 Guests</th>
                            <th>100 Guests</th>
                        </tr>
                    </thead>
                    <tbody id="matrixBody">
                        <!-- Filled by JS -->
                    </tbody>
                </table>
                <p style="text-align: center; color: #666; margin-top: 1rem; font-size: 0.8rem;">
                    * Includes 3 nights @ €10,000/night + 10% VAT + base menu (€180/pp) + 3hr open bar (€4,000). USD at €1 = $1.09
                </p>
            </div>
        </div>
    </section>

    <section class="culinary-section" id="menu">
        <div class="section-header">
            <p class="subtitle">The Experience</p>
            <h2>Culinary Packages</h2>
        </div>

        <div class="menu-tiers">
            <div class="menu-card recommended">
                <span class="badge">Base Package</span>
                <h4>Classic Pugliese</h4>
                <div class="menu-price">€180 <span>/person</span></div>
                <ul class="menu-features">
                    <li>Aperitif with cocktails</li>
                    <li>Buffet with 10 Puglian starters</li>
                    <li>First course (pasta or risotto)</li>
                    <li>Second course (meat or fish)</li>
                    <li>Dessert buffet (6 options)</li>
                    <li>Wine: 1 bottle per 4 guests</li>
                    <li>Prosecco: 1 bottle per 6 guests</li>
                </ul>
            </div>

            <div class="menu-card">
                <h4>Menu Add-ons</h4>
                <div class="menu-price">+€15-20 <span>/person</span></div>
                <ul class="menu-features">
                    <li>Standard Food Corner (+€15/pp)</li>
                    <li>Seafood Corner (+€20/pp)</li>
                    <li>Raw Seafood Bar (+€15/pp)</li>
                    <li>Pizza Station from Ancient Oven</li>
                    <li>Gin Tasting (sister property)</li>
                    <li>Wine Pairing with Primitivo</li>
                    <li>Midnight Pasta Station</li>
                </ul>
            </div>

            <div class="menu-card">
                <h4>Additional Meals</h4>
                <div class="menu-price">€50-60 <span>/person</span></div>
                <ul class="menu-features">
                    <li>Welcome Dinner in Cave (€60/pp)</li>
                    <li>Farewell Brunch by Pool (€50/pp)</li>
                    <li>Beach Bistro Lunch (€45/pp)</li>
                    <li>Trullo Intimate Dinner (€70/pp)</li>
                    <li>Minimum €4,000 daily spend required</li>
                    <li>Organic farm ingredients</li>
                    <li>Own olive oil & wine included</li>
                </ul>
            </div>
        </div>
    </section>

    <section>
        <div class="section-header">
            <p class="subtitle">Considerations</p>
            <h2>Pros & Cons</h2>
        </div>

        <div class="pros-cons">
            <div class="pros">
                <h3>Why Masseria Potenti</h3>
                <ul>
                    <li>Massive capacity: up to 100 guests overnight</li>
                    <li>Incredible variety of spaces (9+ unique venues)</li>
                    <li>Own organic farm, wine, olive oil production</li>
                    <li>Beach bistro access near flamingo reserve</li>
                    <li>Traditional hammam spa on-site</li>
                    <li>Yoga shala and wellness facilities</li>
                    <li>Can host multi-day immersive experiences</li>
                    <li>3 private villas for VIP guests</li>
                    <li>Own gin distillery in sister property</li>
                    <li>Authentic 16th-century masseria</li>
                    <li>45 min from Brindisi (closer than Bari)</li>
                </ul>
            </div>
            <div class="cons">
                <h3>Things to Consider</h3>
                <ul>
                    <li>Expensive: €33,000 base for 3 nights exclusive use</li>
                    <li>Requires €4,000 minimum meal spend per day</li>
                    <li>€3,000 fee if events held elsewhere</li>
                    <li>3-night minimum stay required</li>
                    <li>More remote in Salento (not near coast towns)</li>
                    <li>Likely exceeds $30k budget significantly</li>
                    <li>Best for 66+ guests to maximize value</li>
                    <li>Complex pricing structure</li>
                </ul>
            </div>
        </div>
    </section>

    <section class="cta-section">
        <h2>Ready to Explore?</h2>
        <p>Contact Masseria Potenti to schedule a video tour or visit in person.</p>
        <div class="cta-buttons">
            <a href="mailto:chiara@masseriapotenti.com" class="btn btn-primary">Email Chiara</a>
            <a href="https://vimeo.com/219337654" target="_blank" class="btn btn-secondary">Watch Wedding Video</a>
        </div>
        <p style="margin-top: 2rem; font-size: 0.9rem; opacity: 0.7;">
            Contact: Chiara Tommasino, GM | +39 335 178 7627 | chiara@masseriapotenti.com
        </p>
    </section>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <script>
        // Navigation visibility
        const nav = document.getElementById('nav');
        window.addEventListener('scroll', () => {
            if (window.scrollY > window.innerHeight * 0.8) {
                nav.classList.add('visible');
            } else {
                nav.classList.remove('visible');
            }
        });

        // Budget Calculator
        const EXCHANGE_RATE = 1.09;
        const BUDGET = 30000;
        const VAT_RATE = 1.10;
        const NIGHTLY_RATE = 10000; // Base exclusive use rate

        const guestSlider = document.getElementById('guestSlider');
        const guestDisplay = document.getElementById('guestDisplay');
        const nightsSelect = document.getElementById('nightsSelect');
        const menuSelect = document.getElementById('menuSelect');
        const barSelect = document.getElementById('barSelect');
        const checkboxItems = document.querySelectorAll('.checkbox-item');

        function getBarCost(hours, guests) {
            if (guests >= 100) {
                // €40 per person for 3 hours, €20 per additional hour
                const baseHours = 3;
                const baseCost = guests * 40;
                const extraHours = Math.max(0, hours - baseHours);
                const extraCost = extraHours * guests * 20;
                return baseCost + extraCost;
            } else {
                // Flat rate: €4,000 for 3 hours, €800 per extra hour
                const baseHours = 3;
                const baseCost = 4000;
                const extraHours = Math.max(0, hours - baseHours);
                const extraCost = extraHours * 800;
                return baseCost + extraCost;
            }
        }

        function calculateBudget() {
            const guests = parseInt(guestSlider.value);
            const nights = parseInt(nightsSelect.value);
            const menuPrice = parseInt(menuSelect.value);
            const barHours = parseInt(barSelect.value);

            // Exclusive use rental
            const rentalCost = NIGHTLY_RATE * nights * VAT_RATE;

            // Catering
            const cateringCost = guests * menuPrice * VAT_RATE;

            // Open bar
            const barCost = getBarCost(barHours, guests) * VAT_RATE;

            // Add-ons
            let addonCosts = 0;
            let addonItems = [];
            let villasCost = 0;

            checkboxItems.forEach(item => {
                const checkbox = item.querySelector('input');
                if (checkbox.checked) {
                    const price = parseInt(item.dataset.price);
                    const addon = item.dataset.addon;

                    if (addon.includes('villa')) {
                        // Villa costs are per night
                        const villaCost = price * nights * VAT_RATE;
                        villasCost += villaCost;
                        addonItems.push({
                            name: item.textContent.trim(),
                            price: villaCost,
                            detail: `${nights} nights × €${price}/night`
                        });
                    } else {
                        // Per-person costs
                        const itemCost = price * guests * VAT_RATE;
                        addonCosts += itemCost;
                        addonItems.push({
                            name: item.textContent.trim(),
                            price: itemCost,
                            detail: `€${price} × ${guests} guests`
                        });
                    }
                }
            });

            const totalEur = rentalCost + cateringCost + barCost + addonCosts + villasCost;
            const totalUsd = Math.round(totalEur * EXCHANGE_RATE);

            // Update display
            guestDisplay.textContent = guests;

            // Build breakdown table
            const breakdownBody = document.getElementById('breakdownBody');
            let rows = `
                <tr>
                    <td>
                        <div class="item-name">Exclusive Use Rental</div>
                        <div class="item-detail">${nights} nights × €10,000 + 10% VAT</div>
                    </td>
                    <td class="item-price">€${Math.round(rentalCost).toLocaleString()}</td>
                </tr>
                <tr>
                    <td>
                        <div class="item-name">Wedding Catering</div>
                        <div class="item-detail">€${menuPrice} × ${guests} guests + 10% VAT</div>
                    </td>
                    <td class="item-price">€${Math.round(cateringCost).toLocaleString()}</td>
                </tr>
                <tr>
                    <td>
                        <div class="item-name">Open Bar (${barHours} hours)</div>
                        <div class="item-detail">${guests >= 100 ? '€40/person base, €20/hr extra' : '€4,000 base, €800/hr extra'} + 10% VAT</div>
                    </td>
                    <td class="item-price">€${Math.round(barCost).toLocaleString()}</td>
                </tr>
            `;

            addonItems.forEach(addon => {
                rows += `
                    <tr>
                        <td>
                            <div class="item-name">${addon.name.split('(')[0].trim()}</div>
                            <div class="item-detail">${addon.detail} + 10% VAT</div>
                        </td>
                        <td class="item-price">€${Math.round(addon.price).toLocaleString()}</td>
                    </tr>
                `;
            });

            rows += `
                <tr class="total-row">
                    <td><strong>Total (EUR)</strong></td>
                    <td class="item-price"><strong>€${Math.round(totalEur).toLocaleString()}</strong></td>
                </tr>
            `;

            breakdownBody.innerHTML = rows;

            // Update total display
            const totalAmount = document.getElementById('totalAmount');
            const budgetStatus = document.getElementById('budgetStatus');
            const remainingAmount = document.getElementById('remainingAmount');

            totalAmount.textContent = `$${totalUsd.toLocaleString()}`;

            const remaining = BUDGET - totalUsd;
            remainingAmount.textContent = remaining >= 0 ? `$${remaining.toLocaleString()}` : `-$${Math.abs(remaining).toLocaleString()}`;

            if (remaining >= 10000) {
                totalAmount.className = 'amount under-budget';
                budgetStatus.className = 'budget-status good';
                budgetStatus.textContent = `Under budget by $${remaining.toLocaleString()}`;
            } else if (remaining >= 0) {
                totalAmount.className = 'amount';
                budgetStatus.className = 'budget-status warning';
                budgetStatus.textContent = `$${remaining.toLocaleString()} remaining for vendors`;
            } else {
                totalAmount.className = 'amount over-budget';
                budgetStatus.className = 'budget-status over';
                budgetStatus.textContent = `Over budget by $${Math.abs(remaining).toLocaleString()}`;
            }
        }

        function buildMatrix() {
            const guestCounts = [30, 40, 50, 66, 80, 100];
            const nights = 3;
            const configs = [
                { name: 'Base Menu (€180/pp)', menuPrice: 180 },
                { name: 'Base + 1 Villa', menuPrice: 180, villas: 1 },
                { name: 'Premium Menu (€210/pp)', menuPrice: 210 },
                { name: 'Premium + 2 Villas', menuPrice: 210, villas: 2 },
                { name: 'Exclusive (€230/pp)', menuPrice: 230 },
                { name: 'Full Package + 3 Villas', menuPrice: 230, villas: 3 }
            ];

            const matrixBody = document.getElementById('matrixBody');
            let html = '';

            configs.forEach(config => {
                html += `<tr><td>${config.name}</td>`;
                guestCounts.forEach(guests => {
                    const rental = NIGHTLY_RATE * nights * VAT_RATE;
                    const catering = guests * config.menuPrice * VAT_RATE;
                    const bar = getBarCost(3, guests) * VAT_RATE;
                    const villas = (config.villas || 0) * 1600 * nights * VAT_RATE;

                    const total = rental + catering + bar + villas;
                    const usd = Math.round(total * EXCHANGE_RATE);
                    const remaining = BUDGET - usd;

                    let className = '';
                    if (remaining >= 10000) className = 'good';
                    else if (remaining >= 0) className = 'warning';
                    else className = 'over';

                    html += `<td class="${className}">$${usd.toLocaleString()}<br><small>${remaining >= 0 ? '+' : ''}$${remaining.toLocaleString()}</small></td>`;
                });
                html += '</tr>';
            });

            matrixBody.innerHTML = html;
        }

        // Event listeners
        guestSlider.addEventListener('input', calculateBudget);
        nightsSelect.addEventListener('change', calculateBudget);
        menuSelect.addEventListener('change', calculateBudget);
        barSelect.addEventListener('change', calculateBudget);

        checkboxItems.forEach(item => {
            const checkbox = item.querySelector('input');
            checkbox.addEventListener('change', () => {
                item.classList.toggle('active', checkbox.checked);
                calculateBudget();
            });
        });

        // Initialize
        calculateBudget();
        buildMatrix();

        // D3 Flight Map
        async function createFlightMap() {
            const container = document.getElementById('flightMap');
            const width = container.offsetWidth;
            const height = container.offsetHeight;

            // Clear any existing content
            container.innerHTML = '';

            const svg = d3.select('#flightMap')
                .append('svg')
                .attr('width', width)
                .attr('height', height)
                .style('cursor', 'grab');

            // Gradient definitions
            const defs = svg.append('defs');

            // Route gradient
            const routeGradient = defs.append('linearGradient')
                .attr('id', 'routeGradient')
                .attr('gradientUnits', 'userSpaceOnUse');

            routeGradient.append('stop')
                .attr('offset', '0%')
                .attr('stop-color', '#b8956e');

            routeGradient.append('stop')
                .attr('offset', '50%')
                .attr('stop-color', '#d4af7a');

            routeGradient.append('stop')
                .attr('offset', '100%')
                .attr('stop-color', '#c4724e');

            // Glow filter
            const glow = defs.append('filter')
                .attr('id', 'glow')
                .attr('x', '-50%')
                .attr('y', '-50%')
                .attr('width', '200%')
                .attr('height', '200%');

            glow.append('feGaussianBlur')
                .attr('stdDeviation', '3')
                .attr('result', 'coloredBlur');

            const glowMerge = glow.append('feMerge');
            glowMerge.append('feMergeNode').attr('in', 'coloredBlur');
            glowMerge.append('feMergeNode').attr('in', 'SourceGraphic');

            // Create a group for all map content (will be transformed by zoom)
            const mapGroup = svg.append('g').attr('class', 'map-group');

            // Projection - centered on the Atlantic
            const projection = d3.geoNaturalEarth1()
                .center([-40, 38])
                .scale(width * 0.32)
                .translate([width / 2, height / 2]);

            const path = d3.geoPath().projection(projection);

            // Zoom behavior
            const zoom = d3.zoom()
                .scaleExtent([0.5, 4])
                .on('zoom', (event) => {
                    mapGroup.attr('transform', event.transform);
                })
                .on('start', () => svg.style('cursor', 'grabbing'))
                .on('end', () => svg.style('cursor', 'grab'));

            svg.call(zoom);

            // Double-click to reset
            svg.on('dblclick.zoom', () => {
                svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity);
            });

            // Load world map
            const world = await d3.json('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json');
            const countries = topojson.feature(world, world.objects.countries);

            // Add graticule
            const graticule = d3.geoGraticule()
                .step([20, 20]);

            mapGroup.append('path')
                .datum(graticule)
                .attr('class', 'graticule')
                .attr('d', path);

            // Draw countries
            mapGroup.selectAll('.land')
                .data(countries.features)
                .enter()
                .append('path')
                .attr('class', 'land')
                .attr('d', path);

            // City coordinates
            const cities = {
                lax: { coords: [-118.4085, 33.9425], code: 'LAX', name: 'Los Angeles' },
                rome: { coords: [12.4964, 41.9028], code: 'FCO', name: 'Rome' },
                brindisi: { coords: [17.947, 40.6576], code: 'BDS', name: 'Brindisi' },
                venue: { coords: [17.6, 40.4], name: 'Masseria Potenti' }
            };

            // Create great circle paths
            function createArc(start, end) {
                const interpolate = d3.geoInterpolate(start, end);
                const numPoints = 100;
                const points = [];
                for (let i = 0; i <= numPoints; i++) {
                    points.push(interpolate(i / numPoints));
                }
                return points;
            }

            const route1Points = createArc(cities.lax.coords, cities.rome.coords);
            const route2Points = createArc(cities.rome.coords, cities.brindisi.coords);
            const route3Points = createArc(cities.brindisi.coords, cities.venue.coords);

            const lineGenerator = d3.line()
                .x(d => projection(d)[0])
                .y(d => projection(d)[1])
                .curve(d3.curveCatmullRom);

            // Update gradient coordinates
            const laxPos = projection(cities.lax.coords);
            const venuePos = projection(cities.venue.coords);
            routeGradient
                .attr('x1', laxPos[0])
                .attr('y1', laxPos[1])
                .attr('x2', venuePos[0])
                .attr('y2', venuePos[1]);

            // Draw route glow
            mapGroup.append('path')
                .datum(route1Points)
                .attr('class', 'flight-route-glow')
                .attr('d', lineGenerator);

            // Draw main route LAX -> Rome
            const route1 = mapGroup.append('path')
                .datum(route1Points)
                .attr('class', 'flight-route')
                .attr('d', lineGenerator);

            // Draw route Rome -> Brindisi
            mapGroup.append('path')
                .datum(route2Points)
                .attr('class', 'flight-route')
                .attr('d', lineGenerator)
                .style('stroke-width', '2');

            // Draw route Brindisi -> Venue
            mapGroup.append('path')
                .datum(route3Points)
                .attr('class', 'flight-route')
                .attr('d', lineGenerator)
                .style('stroke-width', '1.5')
                .style('stroke-dasharray', '4, 4');

            // Animated dashed overlay
            const totalLength1 = route1.node().getTotalLength();
            mapGroup.append('path')
                .datum(route1Points)
                .attr('class', 'route-dash')
                .attr('d', lineGenerator)
                .attr('stroke-dasharray', `${totalLength1} ${totalLength1}`)
                .attr('stroke-dashoffset', totalLength1)
                .transition()
                .duration(3000)
                .ease(d3.easeLinear)
                .attr('stroke-dashoffset', 0);

            // City markers
            Object.entries(cities).forEach(([key, city]) => {
                const pos = projection(city.coords);
                const g = mapGroup.append('g')
                    .attr('class', 'city-marker')
                    .attr('transform', `translate(${pos[0]}, ${pos[1]})`);

                // Pulse animation for origin and destination
                if (key === 'lax' || key === 'venue') {
                    g.append('circle')
                        .attr('class', 'city-marker-pulse')
                        .attr('r', 8);
                }

                // Outer ring
                g.append('circle')
                    .attr('class', 'city-marker-ring')
                    .attr('r', key === 'venue' ? 10 : 8);

                // Inner dot
                g.append('circle')
                    .attr('r', key === 'venue' ? 5 : 4)
                    .attr('fill', key === 'venue' ? '#c4724e' : '#b8956e');

                // Star for venue
                if (key === 'venue') {
                    const starPath = 'M0,-7 L1.5,-2 L7,-2 L2.5,1.5 L4,7 L0,3.5 L-4,7 L-2.5,1.5 L-7,-2 L-1.5,-2 Z';
                    g.append('path')
                        .attr('class', 'venue-star')
                        .attr('d', starPath)
                        .attr('transform', 'translate(0, -18) scale(0.7)');
                }

                // Labels
                const labelOffset = key === 'lax' ? [-10, -18] :
                                   key === 'rome' ? [0, -18] :
                                   key === 'brindisi' ? [12, 0] :
                                   [12, -5];

                const anchor = key === 'lax' ? 'end' :
                              key === 'rome' ? 'middle' :
                              'start';

                if (city.code) {
                    g.append('text')
                        .attr('class', 'city-label')
                        .attr('x', labelOffset[0])
                        .attr('y', labelOffset[1])
                        .attr('text-anchor', anchor)
                        .text(city.code);

                    g.append('text')
                        .attr('class', 'city-sublabel')
                        .attr('x', labelOffset[0])
                        .attr('y', labelOffset[1] + 12)
                        .attr('text-anchor', anchor)
                        .text(city.name);
                } else {
                    g.append('text')
                        .attr('class', 'city-label')
                        .attr('x', labelOffset[0])
                        .attr('y', labelOffset[1])
                        .attr('text-anchor', anchor)
                        .style('font-size', '10px')
                        .text(city.name);
                }
            });

            // Animated airplane
            const planeSymbol = 'M-1.5,0 L-8,-2.5 L-8,-1 L-3,0 L-8,1 L-8,2.5 L-1.5,0 M0,-0.8 L6,0 L0,0.8 Z';

            const plane = mapGroup.append('g')
                .attr('class', 'plane-group');

            plane.append('path')
                .attr('class', 'plane-icon')
                .attr('d', planeSymbol)
                .attr('transform', 'scale(2)')
                .attr('filter', 'url(#glow)');

            // Animate plane along route
            function animatePlane() {
                const allPoints = [...route1Points, ...route2Points.slice(1), ...route3Points.slice(1)];
                let i = 0;

                function updatePlane() {
                    if (i >= allPoints.length - 1) {
                        i = 0;
                        setTimeout(updatePlane, 2000);
                        return;
                    }

                    const curr = projection(allPoints[i]);
                    const next = projection(allPoints[Math.min(i + 1, allPoints.length - 1)]);
                    const angle = Math.atan2(next[1] - curr[1], next[0] - curr[0]) * 180 / Math.PI;

                    plane.attr('transform', `translate(${curr[0]}, ${curr[1]}) rotate(${angle})`);

                    i++;
                    setTimeout(updatePlane, 40);
                }

                updatePlane();
            }

            animatePlane();

            // Ocean label
            mapGroup.append('text')
                .attr('x', width * 0.35)
                .attr('y', height * 0.65)
                .attr('fill', 'rgba(255,255,255,0.15)')
                .attr('font-size', '14px')
                .attr('font-style', 'italic')
                .attr('font-family', 'Cormorant Garamond, serif')
                .text('Atlantic Ocean');

            // Add zoom hint
            svg.append('text')
                .attr('x', 10)
                .attr('y', height - 10)
                .attr('fill', 'rgba(255,255,255,0.4)')
                .attr('font-size', '10px')
                .attr('font-family', 'Montserrat, sans-serif')
                .text('Drag to pan • Scroll to zoom • Double-click to reset');
        }

        // Initialize flight map
        createFlightMap();

        // Redraw on resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(createFlightMap, 250);
        });
    </script>
</body>
</html>
